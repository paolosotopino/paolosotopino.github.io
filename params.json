{"name":"paolosotopino","tagline":"java ruby node.js mongodb","body":"### Getting sum of 'likes' with Ruby, Mongoid and MongoDB\r\nSuppose a collection of documents in MongoDB with some data:\r\n\r\n```\r\n{ \r\n  \"_id\" : ObjectId(\"5355ffc3d3aa3c03e8ba6dca\")\r\n  \"name\" : \"Name 1\"\r\n  \"likes\" : [ \"user1\", \"user2\" ]\r\n},\r\n{ \r\n  \"_id\" : ObjectId(\"5355ffc3d3aa3c03e8ba6dcb\")\r\n  \"name\" : \"Name 2\"\r\n  \"likes\" : [ \"user1\", \"user2\", \"user4\" ]\r\n}\r\n```\r\nThen, for return documents with '_id', 'name' and 'totalLikes' just need this simple code:\r\n\r\n```\r\ndata = Data.collection.aggregate([\r\n    { '$unwind' => '$likes' },\r\n    { '$group' => { '_id' => { '_id' => '$_id', 'name' => '$name', 'totalLikes' => { '$sum' => 1 } } },\r\n    { '$project' => { '_id' => '$_id._id', 'name' => '$_id.name', 'totalLikes' => '$totalLikes' } },\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t] )\r\n```\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}